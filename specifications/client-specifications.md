# Client Specification Overview
This document contains the specifications for the Client software. The Client software is defined by the following
high-level features:

* Governor
* Docker container with SSH
* Persistant Storage
  * Encryption
* Deployment Packages (pre-configured scripts for setting up apps like webservers, file sharing, etc.)
* Testing

The sections below detail the specifications for each of these features:

## Governor (p2pVpsClient.js)
The primary purpose of the governor software is to manage the Docker container and communicate with the
P2P VPS server. It plays the following roles:
* It reads the deviceGUID.json file and registers the Client device with the P2P VPS server.
* It builds the Docker container with information returned by the server after registration.
* It launches the Docker container after being built.
* It sents a heartbeat signal to the P2P VPS server every 10 minutes. The server responds with an expiration date.
* When the expiration date is reached, the governor software stops the Docker container and wipes the flash drive.
It then reregisters itself with the P2P VPS marketplace.

This workflow diagram illustrates how transactions initiated and managed:
![Transaction Worflow](images/workflow.jpg?raw=true "Transaction Worflow")


## Docker Container
A Docker container is generated by the `p2pVpsClient.js` governor application. The Owner initiates the creation
of the Docker container by registering the device in the Marketplace dashboard. They are given a GUID, which they
then copy to the file `deviceGUID.json`. `p2pVpsClient.js` reads this file and makes a
REST API call to the server to register itself. 

After a successful registration call, the server returns a computer generated username, password, and port.
The port is used to establish a reverse SSH tunnel to the Docker container. The username and password are
used to create a user account for the Docker container. This email and password will be emailed to the
renter when they purchase the rental contract on the OpenBazaar network.

When the contract is terminated, the Docker container is destroyed and all persistentdata wiped.
A new Docker container with new login credentials is generated for the next renter.

## Persistent Storage
Persistent storage can take many forms, but a USB flash drive will be encouraged, as SD cards have shown
reliability issues. Most IoT devices, like the Raspberry Pi can boot off an SD card. Extra storage can
easily be accommodated through USB flash drives or even USB external hard drives. 64GB Flash drives will
be a (rough) standard due to their availability and low prices.

Part of the installation instructions for client software will include commands for mounting a USB flash
drive and setting it up for persistent storage with Docker.

### Encryption
Encryption managed by the Device Owner has been explored, but found ineffective. It will be best to put the
responsibility and encryption keys in the hands of the Renter. Owners will be under no obligation to provide
encrypted drives. However, instructions for setting up LUKS encryption inside the renters Docker container
will be provided by this project.

This is an excellent guide that can be adapted to encrypt persistentstorage in a Docker container:
https://launchbylunch.com/posts/2014/Jan/13/encrypting-docker-on-digitalocean/

## Deployment Packages
A collection of scripts will be made available to renters. These are preconfigured shell scripts or some other
type of package manager that allows them to quickly deploy common web services like NextCloud, a blog, a webserver,
a single page application development environment, a TOR node, an OpenBazaar server, VPN software, etc. Easy scripts to deploy many of 
[these use cases](https://raspberry-hosting.com/en/applications).

This project will rely on user contributions for this section. If interested, please see our
[Contributions README](../CONTRIBUTING.md).

## Testing
Unit testing is initially planning to use Mocha, but we could use any platform at this stage. We could really use
help with getting a solid unit testing library in place for Client software.
